# AI Docs System v2.1 โ ะะปะฐะฝ ัะปัััะตะฝะธะน

**ะะตััะธั:** 2.0.0 โ 2.1.0  
**ะฆะตะปั:** ะะตะทะพะฟะฐัะฝะพััั, ะผะฐัััะฐะฑะธััะตะผะพััั, ัะฝะธะฒะตััะฐะปัะฝะพััั

---

## ๐ ะงัะพ ะดะตะปะฐะตะผ

| # | ะะฐะดะฐัะฐ | ะกะปะพะถะฝะพััั | ะัะตะผั |
|---|--------|-----------|-------|
| 1 | ะะตะทะพะฟะฐัะฝัะน ะฟะฐััะธะฝะณ config.env + ัะบัะฐะฝะธัะพะฒะฐะฝะธะต regex | ะะธะทะบะฐั | 1ั |
| 2 | ะกะพะฒะผะตััะธะผะพััั ั hook-ะผะตะฝะตะดะถะตัะฐะผะธ (Husky ะธ ะดั.) | ะกัะตะดะฝัั | 1.5ั |
| 3 | Pending Updates (local/shared ะพัะตัะตะดั) | ะกัะตะดะฝัั | 2.5ั |
| 4 | ะัะพะฒะตัะบะฐ ัััะฐัะตะฒัะธั ะดะพะบัะผะตะฝัะพะฒ ะฟัะธ == | ะะธะทะบะฐั | 1ั |
| 5 | ะะตะถะธะผ `uninstall` | ะะธะทะบะฐั | 1ั |
| 6 | ะะฒัะพะผะฐัะธัะตัะบะธะน merge ะบะพะฝัะธะณะฐ (ะบะพะฝัะตัะฒะฐัะธะฒะฝัะน) | ะกัะตะดะฝัั | 2ั |
| 7 | ะฃะผะฝัะน pre-commit (ะฟะพะบะฐะทัะฒะฐะตั ะบัะดะฐ ะฟัะฐะฒะธัั) | ะกัะตะดะฝัั | 1.5ั |
| 8 | ะะพะผะฐะฝะดะฐ `audit` | ะกัะตะดะฝัั | 2ั |

**ะัะพะณะพ:** ~12.5ั

---

## 1๏ธโฃ ะะตะทะพะฟะฐัะฝัะน ะฟะฐััะธะฝะณ config.env

**ะคะฐะนะปั:** `install.sh`, `githooks/pre-commit`, `install.ps1`

### ะัะพะฑะปะตะผะฐ 1: ะัะฟะพะปะฝะตะฝะธะต ะบะพะดะฐ

ะกะตะนัะฐั `source "$config"` โ ััะพ ะธัะฟะพะปะฝะตะฝะธะต ะบะพะดะฐ. ะัะปะธ ะบะพะฝัะธะณ ัะพะดะตัะถะธั `rm -rf /`, ะพะฝ ะฒัะฟะพะปะฝะธััั.

**ะะตัะตะฝะธะต:** ะคัะฝะบัะธั `get_config_value()`:

```bash
get_config_value() {
  local file="$1" key="$2" default="$3"
  grep -E "^${key}=" "$file" 2>/dev/null | cut -d'=' -f2- | head -1 || echo "$default"
}
```

ะะฐะผะตะฝะธัั ะฒัะต `source "$config"` ะฝะฐ ะฒัะทะพะฒั `get_config_value`.

### ะัะพะฑะปะตะผะฐ 2: Regex ะฑะตะท ัะบัะฐะฝะธัะพะฒะฐะฝะธั

ะ pre-commit regex ะฟะฐััะตัะฝั ัััะพัััั ะธะท ะบะพะฝัะธะณะฐ ะฑะตะท ัะบัะฐะฝะธัะพะฒะฐะฝะธั ะผะตัะฐัะธะผะฒะพะปะพะฒ (`.`, `*`, `[`, ะธ ั.ะด.).

ะัะธะผะตั: `.git` ะผะฐััะธััั ะบะฐะบ `any_char + git`, ะฝะต ะบะฐะบ `.git`.

**ะะตัะตะฝะธะต:** ะคัะฝะบัะธั `escape_regex()`:

```bash
escape_regex() {
  sed 's/[.[\*^$()+?{|\\]/\\&/g'
}

csv_to_re() {
  local s="${1:-}" IFS=,
  local out=() token
  for token in $s; do
    token="$(printf '%s' "$token" | escape_regex)"
    out+=("$token")
  done
  printf '(%s)' "$(IFS='|'; echo "${out[*]}")"
}
```

---

## 2๏ธโฃ ะกะพะฒะผะตััะธะผะพััั ั hook-ะผะตะฝะตะดะถะตัะฐะผะธ

**ะคะฐะนะปั:** `install.sh`, `install.ps1`, `.ai-docs-system/config.env`

### ะัะพะฑะปะตะผะฐ

ะกะตะนัะฐั `install.sh` ะฒัะตะณะดะฐ ะดะตะปะฐะตั `git config core.hooksPath .githooks`, ััะพ ะปะพะผะฐะตั Husky, pre-commit framework ะธ ะดััะณะธะต ะผะตะฝะตะดะถะตัั ััะบะพะฒ.

### ะะตัะตะฝะธะต: 3 ัะตะถะธะผะฐ

**ะะพะฑะฐะฒะธัั ะฒ config.env:**

```bash
# โโโ ะะตะถะธะผ ัะฐะฑะพัั ั git hooks โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
# auto     - ะฐะฒัะพะพะฟัะตะดะตะปะตะฝะธะต (managed ะตัะปะธ hooksPath ะฝะต ะทะฐะดะฐะฝ, ะธะฝะฐัะต integrate)
# managed  - ัะธััะตะผะฐ ัะฟัะฐะฒะปัะตั .githooks (ัััะฐะฝะฐะฒะปะธะฒะฐะตั core.hooksPath)
# integrate - ัะธััะตะผะฐ ะฟัะตะดะปะฐะณะฐะตั ะธะฝัะตะณัะฐัะธั (ะฝะต ะผะตะฝัะตั hooksPath)
# off      - ััะบะธ ะฝะต ัััะฐะฝะฐะฒะปะธะฒะฐัััั
HOOKS_MODE=auto
```

**ะะพะณะธะบะฐ install/update:**

1. ะัะพะฒะตัะธัั ัะตะบััะธะน `git config core.hooksPath`
2. ะัะปะธ ะฝะต ะทะฐะดะฐะฝ ะธะปะธ `.githooks` โ **managed ัะตะถะธะผ**:
   - ะกะพััะฐะฝะธัั ะฟัะตะดัะดััะตะต ะทะฝะฐัะตะฝะธะต ะฒ `.ai-docs-system/state/prev-hooksPath`
   - ะฃััะฐะฝะพะฒะธัั `core.hooksPath = .githooks`
   - ะะพะฟะธัะพะฒะฐัั ััะบะธ ะฒ `.githooks/`

3. ะัะปะธ ะทะฐะดะฐะฝ ะดััะณะพะน ะฟััั (husky, etc.) โ **integrate ัะตะถะธะผ**:
   - ะะพะปะพะถะธัั ััะบ ะฒ `.ai-docs-system/hooks/pre-commit`
   - ะัะฒะตััะธ ะธะฝััััะบัะธั:
     ```
     โ ะะฑะฝะฐััะถะตะฝ ะดััะณะพะน ะผะตะฝะตะดะถะตั ััะบะพะฒ (core.hooksPath = .husky)
     
     ะะพะฑะฐะฒััะต ะฒ ะฒะฐั pre-commit ััะบ ะพะดะฝั ัััะพะบั:
     
       .ai-docs-system/hooks/pre-commit || true
     
     ะะปะธ ัะผะตะฝะธัะต ัะตะถะธะผ ะฝะฐ managed: HOOKS_MODE=managed ะฒ config.env
     ```

**ะะพะณะธะบะฐ uninstall:**

- ะัะปะธ ัะตะถะธะผ ะฑัะป managed โ ะฒะพัััะฐะฝะพะฒะธัั `prev-hooksPath` (ะธะปะธ unset)
- ะัะปะธ integrate โ ะฟัะพััะพ ัะดะฐะปะธัั `.ai-docs-system/hooks/`

---

## 3๏ธโฃ Pending Updates (ะผะตะถัะตััะธะพะฝะฝะฐั ะพัะตัะตะดั)

**ะคะฐะนะปั:** `.ai-docs-system/state/pending-updates.queue`, `.ai-docs-system/config.env`, `.ai-docs-system/.gitignore`

### ะัะพะฑะปะตะผะฐ

ะะฐะฑะพัะฐ ัะดะตะปะฐะฝะฐ ะฒ ัะฐัะต A, `==` ะทะฐะฟััะตะฝ ะฒ ัะฐัะต B ัะตัะตะท ัะฐั/ะดะตะฝั โ ะธะฝัะพัะผะฐัะธั ัะตััะตััั ะผะตะถะดั ัะตััะธัะผะธ AI.

### ะะตัะตะฝะธะต: ะคะฐะนะป-ะพัะตัะตะดั (local + optional shared)

**ะกัััะบัััะฐ:**

```
.ai-docs-system/
โโโ state/                        # gitignored (ะปะพะบะฐะปัะฝะพะต ัะพััะพัะฝะธะต)
โ   โโโ pending-updates.queue
โ   โโโ pending-updates.queue0    # fallback ะดะปั ะฟััะตะน ั | ะธะปะธ \t
โ   โโโ prev-hooksPath
โโโ .gitignore                    # ะธะณะฝะพัะธัะพะฒะฐัั state/
```

**ะะฟัะธะพะฝะฐะปัะฝะพ (ะดะปั ะบะพะผะฐะฝะดั):**

```
docs/.pending-updates.queue       # versioned, ะบะพะผะฐะฝะดะฐ ะฒะธะดะธั
```

**ะะพะฝัะธะณััะฐัะธั ะฒ config.env:**

```bash
# โโโ Pending Updates (ะพัะตัะตะดั ะพัะปะพะถะตะฝะฝัั ะพะฑะฝะพะฒะปะตะฝะธะน) โโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
# Local ะพัะตัะตะดั (gitignored, ะผะตะถัะตััะธะพะฝะฝะพััั ะดะปั ะพะดะฝะพะณะพ ัะฐะทัะฐะฑะพััะธะบะฐ)
PENDING_UPDATES_LOCAL=.ai-docs-system/state/pending-updates.queue

# Shared ะพัะตัะตะดั (versioned, ะบะพะผะฐะฝะดะฐ ะฒะธะดะธั; ะฟัััะพ = ะฒัะบะปััะตะฝะพ)
PENDING_UPDATES_SHARED=

# ะัะดะฐ ะฟะธัะฐัั: local|shared|both
PENDING_UPDATES_WRITE=local
```

### ะคะพัะผะฐั ะพัะตัะตะดะธ (pipe-separated, ัะฐะนะปั ัะตัะตะท Tab)

```
# AI Docs System โ Pending Updates Queue
# ะคะพัะผะฐั: timestamp|kind|ref|files_tab|doc_hint|note
# 
# timestamp  - unix timestamp (ัะตะบัะฝะดั)
# kind       - features|architecture|infrastructure
# ref        - commit hash (ะพะฟัะธะพะฝะฐะปัะฝะพ)
# files_tab  - ัะฟะธัะพะบ ัะฐะนะปะพะฒ ัะตัะตะท TAB (\t) โ ะฟะพะทะฒะพะปัะตั ะทะฐะฟัััะต ะฒ ะฟัััั
# doc_hint   - ัะตะบะพะผะตะฝะดัะตะผะฐั ะฟะฐะฟะบะฐ ะดะพะบัะผะตะฝัะฐัะธะธ
# note       - ะบัะฐัะบะฐั ะทะฐะผะตัะบะฐ (ะพะฟัะธะพะฝะฐะปัะฝะพ, ะฑะตะท ะฟัะพะฑะตะปะพะฒ)
#
# ะะดะฝะฐ ะทะฐะฟะธัั = ะพะดะฝะฐ ัััะพะบะฐ. Tab ะฒะธะดะตะฝ ะบะฐะบ ะฟัะพะฑะตะป, ะฟะฐััะธััั ะฝะฐะดัะถะฝะพ.

1737553800|features|a1b2c3d|src/hooks/usePayments.ts	src/components/PaymentForm.tsx|docs/features/payments/|payment_update
1737467700|infrastructure|7f8e9d0|supabase/functions/send-email/index.ts	deploy/Dockerfile|docs/infrastructure/|edge_fn_fix
```

### Auto-fallback ะฝะฐ NUL

- ะะพ ัะผะพะปัะฐะฝะธั ะธัะฟะพะปัะทัะตะผ **Tab (`\t`)** โ ัะดะพะฑะฝะพ ัะธัะฐัั ะธ ะดะตะฑะฐะถะธัั.
- ะัะปะธ ะฟัะธ ะทะฐะฟะธัะธ ะพะฑะฝะฐััะถะธะปะธ, ััะพ **ัะพัั ะฑั ะพะดะธะฝ ะฟััั ัะพะดะตัะถะธั** `|` **ะธะปะธ** `\t` (ัะตะดะบะพ, ะฝะพ ะฒะพะทะผะพะถะฝะพ ะฝะฐ *nix) โ **ะฐะฒัะพะผะฐัะธัะตัะบะธ ะฟะธัะตะผ ะทะฐะฟะธัั ะฒ fallback-ัะฐะนะป**:
  - `.ai-docs-system/state/pending-updates.queue0`
  - ัะพัะผะฐั fallback: **NUL-separated** (`\0`) ะดะปั ะฒัะตั ะฟะพะปะตะน ะธ ัะฟะธัะบะฐ ัะฐะนะปะพะฒ
- ะัะธ `==` ะธ `audit` ัะธัะฐะตะผ **ะพะฑะฐ ัะฐะนะปะฐ**: `pending-updates.queue` ะธ `pending-updates.queue0` (ะตัะปะธ ัััะตััะฒัะตั).

ะญัะพ ัะพััะฐะฝัะตั ัะธัะฐะฑะตะปัะฝะพััั ะฒ 99.9% ัะปััะฐะตะฒ ะธ ะดะฐัั 100% ะฝะฐะดัะถะฝะพััั ะฝะฐ edge-case ะฟัััั.

### ะะพะณะดะฐ ะทะฐะฟะธััะฒะฐะตััั

**pre-commit hook** โ ะฟัะธ ะบะพะผะผะธัะต ะบะพะดะฐ ะฑะตะท ะพะฑะฝะพะฒะปะตะฝะธั ะดะพะบะธ:

```bash
# ะะพัะผะฐะปะธะทะพะฒะฐัั ัะฟะธัะพะบ ัะฐะนะปะพะฒ: \n โ TAB
files_tab=$(echo "$changed_code" | tr '\n' '\t' | sed 's/\t$//')
timestamp=$(date +%s)
kind="features"  # ะฟะพ MAP_*
doc_hint="docs/features/"

# ะัะพะฒะตัะบะฐ ะฝะฐ ะฟัะพะฑะปะตะผะฝัะต ัะธะผะฒะพะปั
if echo "$files_tab" | grep -qE '\||	'; then
  # Fallback ะฝะฐ NUL-separated
  printf '%s\0%s\0%s\0%s\0%s\0%s\n' "$timestamp" "$kind" "" "$files_tab" "$doc_hint" "" \
    | tr '\0' '\0' >> "${PENDING_UPDATES_LOCAL}0"
else
  # ะะฑััะฝัะน ัะพัะผะฐั
  echo "$timestamp|$kind||$files_tab|$doc_hint|" >> "$PENDING_UPDATES_LOCAL"
fi
```

### ะะพะณะดะฐ ัะธัะฐะตััั ะธ ะพะฑัะฐะฑะฐััะฒะฐะตััั

**ะัะธ `==`** โ ะฒ `.ai-docs-system/rules/shortcuts.md`:

```markdown
### `==` โ ะะฑะฝะพะฒะธัั ะดะพะบัะผะตะฝัะฐัะธั

1. **ะัะพะฒะตัั pending updates:**
   - ะัะพัะธัะฐะน `PENDING_UPDATES_LOCAL` ะธ `PENDING_UPDATES_SHARED` (ะตัะปะธ ะทะฐะดะฐะฝ)
   - ะขะฐะบะถะต ะฟัะพัะธัะฐะน `.queue0` ัะฐะนะปั (ะตัะปะธ ัััะตััะฒััั)
   - ะะฐััะธะฝะณ: ัะฐะทะดะตะปะธัะตะปั ะฟะพะปะตะน `|`, ัะฐะทะดะตะปะธัะตะปั ัะฐะนะปะพะฒ ะฒะฝัััะธ ะฟะพะปั โ TAB (`\t`)
   - ะัะปะธ ะตััั ะทะฐะฟะธัะธ โ ะฟะพะบะฐะถะธ ะฟะพะปัะทะพะฒะฐัะตะปั:
     ```
     ๐ ะะตะพะฑัะฐะฑะพัะฐะฝะฝัะต ะธะทะผะตะฝะตะฝะธั ะธะท ะฟัะตะดัะดััะธั ัะตััะธะน:
     
     2026-01-22 15:30 (2 ัะฐัะฐ ะฝะฐะทะฐะด):
       โข src/hooks/usePayments.ts
       โข src/components/PaymentForm.tsx
       โ ะะตะบะพะผะตะฝะดัะตััั: docs/features/payments/
     
     ะะฑัะฐะฑะพัะฐัั ะธั ัะตะนัะฐั?
     ```
2. ะะพัะปะต ะพะฑัะฐะฑะพัะบะธ โ **ัะดะฐะปะธ ัััะพะบั** ะธะท ัะฐะนะปะฐ ะพัะตัะตะดะธ
```

**ะัะธะผะตั ะฟะฐััะธะฝะณะฐ ะฒ bash:**

```bash
while IFS='|' read -r ts kind ref files_tab doc note; do
  IFS=$'\t' read -ra files_arr <<< "$files_tab"
  # files_arr ัะตะฟะตัั ะผะฐััะธะฒ ัะฐะนะปะพะฒ
done < "$PENDING_UPDATES_LOCAL"
```

---

## 4๏ธโฃ ะัะพะฒะตัะบะฐ ัััะฐัะตะฒัะธั ะดะพะบัะผะตะฝัะพะฒ

**ะคะฐะนะป:** `.ai-docs-system/config.env`

**ะะพะฑะฐะฒะธัั ะฟะฐัะฐะผะตััั:**

```bash
# โโโ ะัะพะฒะตัะบะฐ ะฐะบััะฐะปัะฝะพััะธ ะดะพะบัะผะตะฝัะพะฒ โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
# ะงะตัะตะท ัะบะพะปัะบะพ ะดะฝะตะน ะดะพะบัะผะตะฝั ััะธัะฐะตััั ัััะฐัะตะฒัะธะผ
DOC_STALE_DAYS=30

# ะะฐะบัะธะผัะผ ัััะฐัะตะฒัะธั ะดะพะบัะผะตะฝัะพะฒ ะฒ ะฒัะฒะพะดะต (ะพััะฐะปัะฝัะต "ะตัั N...")
DOC_STALE_MAX=5
```

**ะัะธ `==`** โ ะฒ `.ai-docs-system/rules/shortcuts.md`:

```markdown
3. **ะัะพะฒะตัั ัััะฐัะตะฒัะธะต ะดะพะบัะผะตะฝัั:**
   - ะะฐะนะดะธ ะฒัะต ัะฐะนะปั ะฒ `docs/` ั ะฟะพะปะตะผ `Last verified`
   - ะัะปะธ ะดะฐัะฐ > DOC_STALE_DAYS ะดะฝะตะน ะฝะฐะทะฐะด โ ะดะพะฑะฐะฒั ะฒ ัะฟะธัะพะบ
   - ะัะปะธ ัะฟะธัะพะบ > DOC_STALE_MAX โ ะฟะพะบะฐะทัะฒะฐะน ัะพะฟ + "ะตัั N ะดะพะบัะผะตะฝัะพะฒ"
   - ะะพะบะฐะถะธ ะฟะพะปัะทะพะฒะฐัะตะปั:
     ```
     โฐ ะญัะธ ะดะพะบัะผะตะฝัั ะฝะต ะฟัะพะฒะตััะปะธัั >30 ะดะฝะตะน:
     
       โข docs/infrastructure/DEPLOY.md โ 219 ะดะฝะตะน ะฝะฐะทะฐะด
       โข docs/features/auth/README.md โ 52 ะดะฝั ะฝะฐะทะฐะด
       โข docs/features/payments/STRIPE.md โ 45 ะดะฝะตะน ะฝะฐะทะฐะด
       (ะตัั 3 ะดะพะบัะผะตะฝัะฐ...)
     
     ะัะพะนัะธัั ะฟะพ ะฝะธะผ ัะตะนัะฐั?
     ```
4. ะัะปะธ ะฟะพะปัะทะพะฒะฐัะตะปั ัะพะณะปะฐัะฐะตััั โ ะฟัะพัะธัะฐะน, ะฟัะพะฒะตัั ะฐะบััะฐะปัะฝะพััั, ะพะฑะฝะพะฒะธ `Last verified`
```

---

## 5๏ธโฃ ะะตะถะธะผ `uninstall`

**ะคะฐะนะปั:** `install.sh`, `install.ps1`

**ะงัะพ ะดะพะฑะฐะฒะธัั:**

- ะะพะฒัะน ัะตะถะธะผ: `./install.sh /path/to/project uninstall`
- ะฃะดะฐะปัะตั: `.ai-docs-system/` (ะบัะพะผะต `state/` โ ะผะพะถะฝะพ ัะฟัะพัะธัั)
- ะฃะดะฐะปัะตั: `.githooks/pre-commit*` (ะตัะปะธ managed)
- ะะพัััะฐะฝะฐะฒะปะธะฒะฐะตั: `git config core.hooksPath` ะธะท `.ai-docs-system/state/prev-hooksPath`
- ะฃะดะฐะปัะตั ะฑะปะพะบ `# BEGIN/END ai-docs-system` ะธะท `.cursorrules`, `CLAUDE.md`, `.clinerules`, `.github/copilot-instructions.md`
- ะะ ัะดะฐะปัะตั `docs/` (ะดะฐะฝะฝัะต ะฟะพะปัะทะพะฒะฐัะตะปั)

**ะะทะผะตะฝะตะฝะธั ะฒ usage():**

```
ะะตะถะธะผั:
  install    ะะพะปะฝะฐั ัััะฐะฝะพะฒะบะฐ
  update     ะะฑะฝะพะฒะปะตะฝะธะต
  uninstall  ะฃะดะฐะปะตะฝะธะต ะผะพะดัะปั (docs/ ัะพััะฐะฝัะตััั)
```

---

## 6๏ธโฃ ะะฒัะพะผะฐัะธัะตัะบะธะน merge ะบะพะฝัะธะณะฐ

**ะคะฐะนะปั:** `install.sh`, `install.ps1`

### ะัะพะฑะปะตะผะฐ

ะัะธ `update` ะฝะพะฒัะต ะบะปััะธ (ะฝะฐะฟัะธะผะตั `structure` ะฒ `RULES_ENABLED`) ะฝะต ะดะพะฑะฐะฒะปััััั ะบ ัััะตััะฒัััะธะผ ัะทะตัะฐะผ.

### ะะตัะตะฝะธะต: ะะพะฝัะตัะฒะฐัะธะฒะฝัะน merge

**ะคัะฝะบัะธั `merge_config()`:**

1. ะงะธัะฐะตั ะดะตัะพะปัะฝัะน ะบะพะฝัะธะณ (ะธะท ัะตะฟะพ)
2. ะงะธัะฐะตั ะบะพะฝัะธะณ ัะทะตัะฐ
3. ะะปั ะบะฐะถะดะพะณะพ ะบะปััะฐ ะฒ ะดะตัะพะปัะฝะพะผ:
   - ะัะปะธ ะบะปััะฐ ะฝะตั ั ัะทะตัะฐ โ ะดะพะฑะฐะฒะปัะตั
   - ะัะปะธ ะบะปัั ะตััั โ ะฝะต ััะพะณะฐะตั (ัะทะตั ะผะพะณ ะธะทะผะตะฝะธัั)

**ะกะฟะตัะธะฐะปัะฝะฐั ะปะพะณะธะบะฐ ะดะปั `RULES_ENABLED` (ั ะฒะตััะธะพะฝะธัะพะฒะฐะฝะธะตะผ ะดะตัะพะปัะพะฒ):**

```bash
# ะะตััะธะพะฝะธัะพะฒะฐะฝะธะต ะธะทะฒะตััะฝัั ะดะตัะพะปัะพะฒ
DEFAULTS_V2_0="doc-first,update-docs,adr,shortcuts"
DEFAULTS_V2_1="doc-first,update-docs,adr,shortcuts,structure"

USER_RULES=$(get_config_value "$USER_CONFIG" "RULES_ENABLED")
NEW_DEFAULT="$DEFAULTS_V2_1"

# ะะตัะดะถะธัั ัะพะปัะบะพ ะตัะปะธ:
# 1. ะฃ ัะทะตัะฐ ะฝะตั RULES_ENABLED ะฒะพะพะฑัะต, ะะะ
# 2. RULES_ENABLED ัะพะฒะฟะฐะดะฐะตั ั ะพะดะฝะธะผ ะธะท ะธะทะฒะตััะฝัั ะดะตัะพะปัะพะฒ (ะฑะตะทะพะฟะฐัะฝะพ ะพะฑะฝะพะฒะธัั)

if [[ -z "$USER_RULES" || "$USER_RULES" == "$DEFAULTS_V2_0" ]]; then
  # ะะตะทะพะฟะฐัะฝะพ ะผะตัะดะถะธัั โ ัะทะตั ะฝะต ะบะฐััะพะผะธะทะธัะพะฒะฐะป
  set_config_value "$USER_CONFIG" "RULES_ENABLED" "$NEW_DEFAULT"
  log_info "RULES_ENABLED ะพะฑะฝะพะฒะปัะฝ: $NEW_DEFAULT"
else
  # ะะต ััะพะณะฐะตะผ โ ัะทะตั ะบะฐััะพะผะธะทะธัะพะฒะฐะป
  log_warn "RULES_ENABLED ะฝะต ะพะฑะฝะพะฒะปัะฝ (ะบะฐััะพะผะธะทะธัะพะฒะฐะฝ ะฟะพะปัะทะพะฒะฐัะตะปะตะผ)"
  log_warn "ะะพะฒัะต ะฟัะฐะฒะธะปะฐ ะดะพัััะฟะฝั: structure (ะดะพะฑะฐะฒััะต ะฒัััะฝัั ะตัะปะธ ะฝัะถะฝะพ)"
fi
```

---

## 7๏ธโฃ ะฃะผะฝัะน pre-commit

**ะคะฐะนะป:** `githooks/pre-commit`

**ะงัะพ ัะตะนัะฐั:** `ะะฐะฟะพะผะธะฝะฐะฝะธะต: ะธะทะผะตะฝะธะปัั ะบะพะด, ะฝะพ ะดะพะบัะผะตะฝัะฐัะธั ะฝะต ะพะฑะฝะพะฒะปะตะฝะฐ`

**ะงัะพ ะฑัะดะตั:**

```
ะะฐะฟะพะผะธะฝะฐะฝะธะต: ะธะทะผะตะฝะธะปัั ะบะพะด, ะฝะพ ะดะพะบัะผะตะฝัะฐัะธั ะฝะต ะพะฑะฝะพะฒะปะตะฝะฐ

ะะทะผะตะฝัะฝะฝัะต ัะฐะนะปั:
  โข src/hooks/useAuth.ts
  โข src/components/LoginForm.tsx

ะะตะบะพะผะตะฝะดัะตะผัะต ะดะพะบัะผะตะฝัั ะดะปั ะพะฑะฝะพะฒะปะตะฝะธั:
  โข docs/features/ (ะบะพะผะฟะพะฝะตะฝัั, ััะบะธ)

๐ ะะฐะฟะธัั ะฒ pending updates ะดะปั ัะปะตะดัััะตะณะพ "=="
```

**ะะตะฐะปะธะทะฐัะธั:**

1. ะะฐะณััะทะธัั `MAP_FEATURES`, `MAP_ARCHITECTURE`, `MAP_INFRASTRUCTURE` ะธะท ะบะพะฝัะธะณะฐ (ัะตัะตะท `get_config_value`)
2. ะะปั ะบะฐะถะดะพะณะพ ะธะทะผะตะฝัะฝะฝะพะณะพ ัะฐะนะปะฐ ะพะฟัะตะดะตะปะธัั ะบะฐัะตะณะพัะธั ะฟะพ ะผะฐะฟะฟะธะฝะณั
3. ะัะฒะตััะธ ัะตะบะพะผะตะฝะดะฐัะธั: "docs/features/" ะธะปะธ "docs/architecture/" ะธ ั.ะด.
4. **ะะฐะฟะธัะฐัั ะฒ pending-updates ะพัะตัะตะดั** (ั auto-fallback ะฝะฐ `.queue0` ะตัะปะธ ะฝัะถะฝะพ)

---

## 8๏ธโฃ ะะพะผะฐะฝะดะฐ `audit`

**ะคะฐะนะปั:** `install.sh`, `install.ps1`

**ะัะฟะพะปัะทะพะฒะฐะฝะธะต:** `./install.sh /path/to/project audit`

**ะงัะพ ะฟัะพะฒะตััะตั:**

1. **Pending Updates** โ ะตััั ะปะธ ะฝะตะพะฑัะฐะฑะพัะฐะฝะฝัะต ะทะฐะฟะธัะธ (local + shared + `.queue0`)
2. **README ะฒ ะบะพะดะต** โ ะตััั ะปะธ `.md` ัะฐะนะปั ะฒ `CODE_DIRS` (ะดะพะปะถะฝั ะฑััั ะฒ `docs/`)
3. **ะะตัะฐะดะฐะฝะฝัะต** โ ะตััั ะปะธ `Status`, `Last verified`, `Owner` ะฒ ะดะพะบัะผะตะฝัะฐั
4. **ะกัััะบัััะฐ docs/** โ ะตััั ะปะธ ะพะฑัะทะฐัะตะปัะฝัะต ะฟะฐะฟะบะธ (features, architecture, infrastructure, adr)
5. **ะฃััะฐัะตะฒัะธะต ะดะพะบัะผะตะฝัั** โ `Last verified` ััะฐััะต `DOC_STALE_DAYS` ะดะฝะตะน (ะฟะพะบะฐะทะฐัั ัะพะฟ `DOC_STALE_MAX`)

**ะัะฒะพะด:**

```
AI Docs System โ ะัะดะธั ะฟัะพะตะบัะฐ /Users/me/my-project

โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
๐ Pending Updates
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

  โณ 2 ะฝะตะพะฑัะฐะฑะพัะฐะฝะฝัั ะพะฑะฝะพะฒะปะตะฝะธั (local):

  1. 2026-01-22 15:30 (2 ัะฐัะฐ ะฝะฐะทะฐะด)
     โข src/hooks/usePayments.ts
     โ docs/features/payments/

  2. 2026-01-21 10:15 (1 ะดะตะฝั ะฝะฐะทะฐะด)
     โข supabase/functions/send-email/index.ts
     โ docs/infrastructure/edge-functions.md

  ๐ก ะะฐะฟัััะธัะต: Cursor Agent โ "=="

โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
๐ README ะฒ ะบะพะดะต
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

  โ src/components/auth/README.md โ ะฟะตัะตะผะตััะธัั ะฒ docs/features/auth/

โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โฐ ะฃััะฐัะตะฒัะธะต ะดะพะบัะผะตะฝัั (>30 ะดะฝะตะน, ัะพะฟ-5)
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

  โ docs/infrastructure/DEPLOY.md โ Last verified: 2025-06-15 (219 ะดะฝะตะน)
  โ docs/features/auth/README.md โ Last verified: 2025-12-01 (52 ะดะฝั)
  โ docs/features/payments/STRIPE.md โ 45 ะดะฝะตะน
  (ะตัั 2 ะดะพะบัะผะตะฝัะฐ...)

โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

ะัะพะณะพ: 2 pending updates, 1 README ะฒ ะบะพะดะต, 7 ัััะฐัะตะฒัะธั ะดะพะบัะผะตะฝัะพะฒ
```

---

## ๐ ะะพััะดะพะบ ัะตะฐะปะธะทะฐัะธะธ

1. **ะะตะทะพะฟะฐัะฝัะน ะฟะฐััะธะฝะณ + ัะบัะฐะฝะธัะพะฒะฐะฝะธะต** (1) โ ะฑะฐะทะพะฒัะน ัะตัะฐะบัะพัะธะฝะณ, ะฝัะถะตะฝ ะดะปั ะพััะฐะปัะฝัั
2. **ะกะพะฒะผะตััะธะผะพััั ั hook-ะผะตะฝะตะดะถะตัะฐะผะธ** (2) โ ะบัะธัะธัะฝะพ ะดะปั ัะฝะธะฒะตััะฐะปัะฝะพััะธ
3. **Pending Updates** (3) โ ัะฐะนะป-ะพัะตัะตะดั + state/ + .gitignore + auto-fallback
4. **ะัะพะฒะตัะบะฐ ัััะฐัะตะฒัะธั** (4) โ ะดะพะฑะฐะฒะธัั ะฒ ะฟัะฐะฒะธะปะฐ shortcuts.md + config.env
5. **Uninstall** (5) โ ะธัะฟะพะปัะทัะตั hooks-compatibility
6. **Merge ะบะพะฝัะธะณะฐ** (6) โ ะบะพะฝัะตัะฒะฐัะธะฒะฝัะน ะฟะพะดัะพะด ั ะฒะตััะธะพะฝะธัะพะฒะฐะฝะธะตะผ
7. **ะฃะผะฝัะน pre-commit** (7) โ ะธัะฟะพะปัะทัะตั ะฑะตะทะพะฟะฐัะฝัะน ะฟะฐััะธะฝะณ + pending updates
8. **Audit** (8) โ ะฝะพะฒะฐั ะบะพะผะฐะฝะดะฐ ั ะฟัะพะฒะตัะบะพะน pending updates

---

## โ ะงัะพ ะะ ะดะตะปะฐะตะผ (ะพัะปะพะถะตะฝะพ ะฝะฐ v2.2+)

- ะะฐะปะธะดะฐัะธั ััััะบัััั docs/ (ะพัะดะตะปัะฝะฐั ะบะพะผะฐะฝะดะฐ) โ ัะฐััะธัะฝะพ ะฟะพะบัััะพ audit
- ะะฝัะตัะฐะบัะธะฒะฝะฐั ัััะฐะฝะพะฒะบะฐ (ะฒัะฑะพั ััะตะบะฐ)
- ะะพะบะฐะปะธะทะฐัะธั ะฟัะฐะฒะธะป (ru/en)

---

## ๐ฏ ะคะธะฝะฐะปะธะทะฐัะธั

ะะพัะปะต ัะตะฐะปะธะทะฐัะธะธ ะฒัะตั ะทะฐะดะฐั:

1. ะะฑะฝะพะฒะธัั `VERSION` โ `2.1.0` ะฒ `install.sh` ะธ `install.ps1`
2. ะกะพะทะดะฐัั `.ai-docs-system/.gitignore` ั ัะพะดะตัะถะธะผัะผ:
   ```
   state/
   *.log
   ```
3. ะะฑะฝะพะฒะธัั `README.md` ั ะฝะพะฒัะผะธ ะฒะพะทะผะพะถะฝะพัััะผะธ v2.1
4. ะะฑะฝะพะฒะธัั `.ai-docs-system/config.env` โ ะดะพะฑะฐะฒะธัั ะฝะพะฒัะต ะฟะฐัะฐะผะตััั:
   - `HOOKS_MODE=auto`
   - `PENDING_UPDATES_LOCAL=.ai-docs-system/state/pending-updates.queue`
   - `PENDING_UPDATES_SHARED=`
   - `PENDING_UPDATES_WRITE=local`
   - `DOC_STALE_DAYS=30`
   - `DOC_STALE_MAX=5`
5. ะะพะผะผะธั ะธ ะฟัั:
   ```bash
   git add -A
   git commit -m "feat(v2.1): ะฑะตะทะพะฟะฐัะฝะพััั, ะผะฐัััะฐะฑะธััะตะผะพััั, pending updates

   - ะะตะทะพะฟะฐัะฝัะน ะฟะฐััะธะฝะณ config.env (ะฑะตะท source)
   - ะกะพะฒะผะตััะธะผะพััั ั Husky/pre-commit framework
   - Pending updates ะพัะตัะตะดั (local/shared, Tab + NUL fallback)
   - ะัะพะฒะตัะบะฐ ัััะฐัะตะฒัะธั ะดะพะบัะผะตะฝัะพะฒ
   - ะะตะถะธะผ uninstall
   - ะะพะฝัะตัะฒะฐัะธะฒะฝัะน merge ะบะพะฝัะธะณะฐ
   - ะฃะผะฝัะน pre-commit ั ัะตะบะพะผะตะฝะดะฐัะธัะผะธ
   - ะะพะผะฐะฝะดะฐ audit
   "
   git push
   ```

---

**ะะปะฐะฝ ะณะพัะพะฒ ะบ ัะตะฐะปะธะทะฐัะธะธ!** ๐
