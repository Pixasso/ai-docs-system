#!/bin/bash
#
# AI Docs System — Pre-commit Hook
# Напоминает обновить документацию при изменении кода
# НЕ блокирует коммиты — просто дружеское напоминание
#

# Получаем изменённые файлы
changed_code=$(git diff --cached --name-only | grep -E "^(src/|services/)" | head -10)
changed_docs=$(git diff --cached --name-only | grep -E "^docs/")

# Если код изменился, но документация нет — показываем напоминание
if [ -n "$changed_code" ] && [ -z "$changed_docs" ]; then
  echo ""
  echo "━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━"
  echo "⚠️  Напоминание: Вы изменили код, но не обновили документацию"
  echo "━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━"
  echo ""
  echo "Изменённые файлы:"
  echo "$changed_code" | while read -r file; do
    echo "  • $file"
  done
  echo ""
  echo "💡 Рекомендуется обновить документацию:"
  echo "   1. Запустите Cursor Agent (Cmd+Shift+I) и введите '=='"
  echo "   2. Или вручную обновите соответствующие файлы в docs/"
  echo ""
  echo "━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━"
  echo ""
fi

# Никогда не блокируем коммит
exit 0
